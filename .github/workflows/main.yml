name: Run Gas Price Forecast

permissions:
  contents: write


on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  forecast:
    runs-on: ubuntu-24.04

    env:
      EIA_API_KEY: ${{ secrets.EIA_API_KEY }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Fetch EIA Storage
        run: |
          python fetch_eia_storage.py > eia_storage.txt
          echo "EIA_STORAGE=$(cat eia_storage.txt)" >> $GITHUB_ENV

      - name: Fetch US Production
        run: |
          python fetch_us_production.py > us_production.txt
          echo "US_PRODUCTION=$(cat us_production.txt)" >> $GITHUB_ENV

      - name: Run Gas Price Forecast
        run: |
          python gas_price_forecast.py \
            --eia-storage "$EIA_STORAGE" \
            --us-production "$US_PRODUCTION" \
            --lng-feedgas 0 \
            --futures-curve 0 \
            --cot-managed-money 0

      - name: Commit forecast output
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add forecast_output.txt

          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Update gas price forecast"
            git push
          fi
