name: Gas Price Forecast

on:
  workflow_dispatch:
  schedule:
    - cron: '0 14 * * 1-5'  # Montag bis Freitag, 14:00 UTC

jobs:
  forecast:
    runs-on: ubuntu-24.04
    env:
      EIA_API_KEY: ${{ secrets.EIA_API_KEY }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: 3.10

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Fetch EIA Storage
        id: eia_storage
        run: |
          python fetch_eia_storage.py > eia_storage.txt
          STORAGE=$(cat eia_storage.txt)
          echo "EIA_STORAGE=$STORAGE" >> $GITHUB_ENV

      - name: Fetch US Production (automatic)
        id: us_production
        run: |
          python fetch_us_production.py > us_production.txt
          US_PROD=$(cat us_production.txt)
          echo "US_PRODUCTION=$US_PROD" >> $GITHUB_ENV

      - name: Fetch LNG Feedgas
        id: lng_feedgas
        run: |
          python fetch_lng_feedgas.py > lng_feedgas.txt
          LNG_FEEDGAS=$(cat lng_feedgas.txt)
          echo "LNG_FEEDGAS=$LNG_FEEDGAS" >> $GITHUB_ENV

      - name: Fetch Futures Curve
        id: futures_curve
        run: |
          python fetch_futures_curve.py > futures_curve.txt
          FUTURES_CURVE=$(cat futures_curve.txt)
          echo "FUTURES_CURVE=$FUTURES_CURVE" >> $GITHUB_ENV

      - name: Fetch COT Managed Money
        id: cot
        run: |
          python fetch_cot_managed_money.py > cot_managed_money.txt
          COT_MANAGED_MONEY=$(cat cot_managed_money.txt)
          echo "COT_MANAGED_MONEY=$COT_MANAGED_MONEY" >> $GITHUB_ENV

      - name: Run Gas Price Forecast
        run: |
          python gas_price_forecast.py \
            --eia-storage "$EIA_STORAGE" \
            --us-production "$US_PRODUCTION" \
            --lng-feedgas "$LNG_FEEDGAS" \
            --futures-curve "$FUTURES_CURVE" \
            --cot-managed-money "$COT_MANAGED_MONEY"

